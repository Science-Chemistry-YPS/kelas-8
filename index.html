import React, { useState, useEffect, useRef } from 'react';
import { Trophy, Clock, Users, Shuffle, Play, Pause, RotateCcw, Plus, Minus, Settings, Sparkles, Smile, RefreshCw } from 'lucide-react';

// Main App Component
export default function App() {
  const [activeTab, setActiveTab] = useState('menu');

  const renderContent = () => {
    switch (activeTab) {
      case 'menu':
        return <Menu setActiveTab={setActiveTab} />;
      case 'wheel':
        return <WheelOfFortune onBack={() => setActiveTab('menu')} />;
      case 'cards':
        return <IcebreakerCards onBack={() => setActiveTab('menu')} />;
      case 'scores':
        return <ScoreBoard onBack={() => setActiveTab('menu')} />;
      case 'timer':
        return <ActivityTimer onBack={() => setActiveTab('menu')} />;
      default:
        return <Menu setActiveTab={setActiveTab} />;
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 font-sans text-slate-800">
      <div className="max-w-4xl mx-auto min-h-screen shadow-2xl bg-white/95 backdrop-blur-sm relative flex flex-col">
        {/* Header */}
        <header className="bg-slate-900 text-white p-4 flex justify-between items-center shadow-md">
          <div className="flex items-center gap-2">
            <Sparkles className="text-yellow-400 animate-pulse" />
            <h1 className="text-xl md:text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-yellow-400 to-orange-500">
              Kelas 8 - Semester 2
            </h1>
          </div>
          <button 
            onClick={() => setActiveTab('menu')}
            className="text-sm font-medium hover:text-yellow-300 transition-colors"
          >
            üè† Home
          </button>
        </header>

        {/* Content Area */}
        <main className="flex-1 p-4 md:p-6 overflow-y-auto">
          {renderContent()}
        </main>

        {/* Footer */}
        <footer className="bg-slate-100 p-3 text-center text-slate-500 text-xs border-t">
          Dibuat untuk Wali Kelas Hebat ‚Ä¢ Semangat Semester 2!
        </footer>
      </div>
    </div>
  );
}

// 1. Menu Component
const Menu = ({ setActiveTab }) => {
  const features = [
    { id: 'wheel', title: 'Roda Nama', icon: <RefreshCw size={40} />, desc: 'Acak siswa untuk maju', color: 'bg-blue-100 text-blue-600 hover:bg-blue-200' },
    { id: 'cards', title: 'Kartu Tantangan', icon: <Smile size={40} />, desc: 'Truth or Dare ringan', color: 'bg-green-100 text-green-600 hover:bg-green-200' },
    { id: 'scores', title: 'Papan Skor', icon: <Trophy size={40} />, desc: 'Kompetisi antar tim', color: 'bg-yellow-100 text-yellow-600 hover:bg-yellow-200' },
    { id: 'timer', title: 'Timer Fokus', icon: <Clock size={40} />, desc: 'Hitung mundur kegiatan', color: 'bg-red-100 text-red-600 hover:bg-red-200' },
  ];

  return (
    <div className="h-full flex flex-col items-center justify-center animate-in fade-in zoom-in duration-300">
      <h2 className="text-3xl font-bold text-slate-800 mb-2 text-center">Halo, Bapak/Ibu Wali Kelas! üëã</h2>
      <p className="text-slate-500 mb-8 text-center max-w-md">Pilih alat bantu di bawah ini untuk memeriahkan suasana kelas hari ini.</p>
      
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-2xl">
        {features.map((feat) => (
          <button
            key={feat.id}
            onClick={() => setActiveTab(feat.id)}
            className={`${feat.color} p-6 rounded-2xl shadow-sm transition-all transform hover:scale-105 hover:shadow-lg flex flex-col items-center justify-center gap-3 text-center border-2 border-transparent hover:border-current`}
          >
            {feat.icon}
            <div>
              <h3 className="text-xl font-bold">{feat.title}</h3>
              <p className="text-sm opacity-80">{feat.desc}</p>
            </div>
          </button>
        ))}
      </div>
    </div>
  );
};

// 2. Wheel of Fortune Component (Simplified visual logic)
const WheelOfFortune = ({ onBack }) => {
  const [names, setNames] = useState("Andi, Budi, Citra, Doni, Eka, Fani");
  const [winner, setWinner] = useState(null);
  const [isSpinning, setIsSpinning] = useState(false);
  const [rotation, setRotation] = useState(0);

  const handleSpin = () => {
    if (isSpinning) return;
    
    const nameArray = names.split(',').map(n => n.trim()).filter(n => n);
    if (nameArray.length === 0) return;

    setIsSpinning(true);
    setWinner(null);

    // Random rotation between 5 and 10 full spins (1800 - 3600 degrees) + random offset
    const randomSpin = 1800 + Math.random() * 1800; 
    const newRotation = rotation + randomSpin;
    
    setRotation(newRotation);

    setTimeout(() => {
      setIsSpinning(false);
      // Calculate winner roughly based on random logic (since visual alignment is tricky in pure CSS without canvas)
      // Ideally we calculate angle mod 360, but for simplicity in this specific "fun" context, we just pick random array item
      const randomWinner = nameArray[Math.floor(Math.random() * nameArray.length)];
      setWinner(randomWinner);
    }, 3000);
  };

  return (
    <div className="flex flex-col h-full">
      <div className="flex justify-between items-center mb-6">
        <h2 className="text-2xl font-bold text-blue-600 flex items-center gap-2">
          <RefreshCw /> Roda Nama
        </h2>
        <button onClick={onBack} className="text-slate-500 hover:text-slate-800">Kembali</button>
      </div>

      <div className="flex-1 flex flex-col md:flex-row gap-8 items-center justify-center">
        {/* Input Area */}
        <div className="w-full md:w-1/3 bg-white p-4 rounded-xl shadow-md border">
          <label className="block text-sm font-medium text-slate-700 mb-2">
            Masukkan Nama Siswa (pisahkan dengan koma):
          </label>
          <textarea
            value={names}
            onChange={(e) => setNames(e.target.value)}
            className="w-full h-32 p-2 border rounded-md focus:ring-2 focus:ring-blue-500 text-sm"
            placeholder="Contoh: Ali, Budi, Caca..."
          />
          <p className="text-xs text-slate-400 mt-2">{names.split(',').filter(n => n.trim()).length} Siswa terdaftar</p>
        </div>

        {/* Wheel Area */}
        <div className="flex-1 flex flex-col items-center justify-center relative">
          <div className="relative">
             {/* Pointer */}
             <div className="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-2 z-10 text-red-500 text-4xl">‚ñº</div>
             
             {/* The Wheel Visual */}
             <div 
                className="w-64 h-64 md:w-80 md:h-80 rounded-full border-8 border-slate-200 bg-[conic-gradient(at_center,_var(--tw-gradient-stops))] from-red-400 via-yellow-400 via-green-400 via-blue-400 to-purple-400 shadow-xl flex items-center justify-center transition-transform duration-[3000ms] cubic-bezier(0.2, 0.8, 0.2, 1)"
                style={{ transform: `rotate(${rotation}deg)` }}
             >
                <div className="w-4 h-4 bg-white rounded-full absolute" />
             </div>
          </div>

          <button
            onClick={handleSpin}
            disabled={isSpinning}
            className="mt-8 px-8 py-3 bg-blue-600 text-white rounded-full font-bold text-lg shadow-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed active:scale-95 transition-all"
          >
            {isSpinning ? 'Sedang Memutar...' : 'PUTAR RODA!'}
          </button>

          {winner && !isSpinning && (
            <div className="absolute inset-0 bg-black/50 backdrop-blur-sm rounded-xl flex items-center justify-center z-20 animate-in zoom-in duration-300">
              <div className="bg-white p-8 rounded-2xl text-center shadow-2xl border-4 border-yellow-400">
                <p className="text-slate-500 text-sm mb-2">Yang terpilih adalah...</p>
                <h3 className="text-4xl font-black text-blue-600 mb-4">{winner}</h3>
                <button 
                  onClick={() => setWinner(null)}
                  className="px-6 py-2 bg-yellow-400 text-slate-900 font-bold rounded-full hover:bg-yellow-500"
                >
                  Lanjut!
                </button>
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

// 3. Icebreaker Cards Component
const IcebreakerCards = ({ onBack }) => {
  const [currentCard, setCurrentCard] = useState(null);
  const [isFlipped, setIsFlipped] = useState(false);

  const questions = [
    { type: 'fun', text: "Apa momen paling memalukan tapi lucu saat liburan kemarin?" },
    { type: 'deep', text: "Satu hal yang paling ingin kamu perbaiki di semester ini?" },
    { type: 'fun', text: "Kalau kamu jadi Kepala Sekolah sehari, aturan apa yang mau kamu buat?" },
    { type: 'action', text: "Tantangan: Tirukan gaya bicara salah satu guru (tanpa sebut nama)!" },
    { type: 'fun', text: "Makanan apa yang kamu makan paling banyak pas liburan?" },
    { type: 'deep', text: "Siapa teman sekelas yang paling kamu rindukan?" },
    { type: 'action', text: "Tantangan: Nyanyikan reff lagu yang lagi viral sekarang!" },
    { type: 'fun', text: "Ceritakan satu kebohongan dan satu fakta, biarkan temanmu menebak!" },
    { type: 'fun', text: "Game apa yang paling sering kamu mainkan pas liburan?" },
    { type: 'deep', text: "Pelajaran apa yang menurutmu paling susah di semester 1?" },
  ];

  const drawCard = () => {
    setIsFlipped(false);
    setTimeout(() => {
      const random = questions[Math.floor(Math.random() * questions.length)];
      setCurrentCard(random);
      setIsFlipped(true);
    }, 200);
  };

  return (
    <div className="flex flex-col h-full max-w-2xl mx-auto">
      <div className="flex justify-between items-center mb-8">
        <h2 className="text-2xl font-bold text-green-600 flex items-center gap-2">
          <Smile /> Kartu Tantangan
        </h2>
        <button onClick={onBack} className="text-slate-500 hover:text-slate-800">Kembali</button>
      </div>

      <div className="flex-1 flex flex-col items-center justify-center">
        <div 
          onClick={drawCard}
          className={`w-full h-64 md:h-80 cursor-pointer perspective-1000 transition-all duration-500 transform ${currentCard ? '' : 'hover:scale-105'}`}
        >
          {/* Card Container */}
          <div className={`relative w-full h-full text-center transition-transform duration-700 transform-style-3d ${isFlipped ? 'rotate-y-180' : ''}`}>
             
             {/* Front (Cover) */}
             {!isFlipped && (
               <div className="absolute inset-0 backface-hidden bg-gradient-to-br from-green-400 to-teal-500 rounded-3xl shadow-xl flex flex-col items-center justify-center border-4 border-white p-6">
                 <span className="text-6xl mb-4">üé≤</span>
                 <h3 className="text-2xl font-bold text-white">Klik untuk Buka Kartu</h3>
               </div>
             )}

             {/* Back (Content) */}
             {isFlipped && currentCard && (
               <div className="absolute inset-0 backface-hidden bg-white rounded-3xl shadow-xl flex flex-col items-center justify-center border-4 border-green-400 p-8 animate-in fade-in zoom-in">
                 <span className="text-sm font-bold uppercase tracking-wider text-green-500 mb-4 bg-green-100 px-3 py-1 rounded-full">
                   {currentCard.type === 'action' ? 'üî• Tantangan' : currentCard.type === 'deep' ? 'ü§î Refleksi' : 'üòÑ Seru-seruan'}
                 </span>
                 <p className="text-2xl font-bold text-slate-800 leading-relaxed">
                   "{currentCard.text}"
                 </p>
               </div>
             )}
          </div>
        </div>

        <button 
          onClick={drawCard}
          className="mt-8 px-8 py-3 bg-green-600 text-white rounded-full font-bold shadow-lg hover:bg-green-700 flex items-center gap-2"
        >
          <Shuffle size={20} /> Ambil Kartu Baru
        </button>
      </div>
    </div>
  );
};

// 4. Scoreboard Component
const ScoreBoard = ({ onBack }) => {
  const [teams, setTeams] = useState([
    { id: 1, name: "Kelompok 1", score: 0 },
    { id: 2, name: "Kelompok 2", score: 0 },
    { id: 3, name: "Kelompok 3", score: 0 },
    { id: 4, name: "Kelompok 4", score: 0 },
  ]);

  const updateScore = (id, delta) => {
    setTeams(teams.map(t => t.id === id ? { ...t, score: Math.max(0, t.score + delta) } : t));
  };

  const updateName = (id, newName) => {
    setTeams(teams.map(t => t.id === id ? { ...t, name: newName } : t));
  };

  const addTeam = () => {
    const newId = teams.length + 1;
    setTeams([...teams, { id: newId, name: `Kelompok ${newId}`, score: 0 }]);
  };

  return (
    <div className="flex flex-col h-full">
      <div className="flex justify-between items-center mb-6">
        <h2 className="text-2xl font-bold text-yellow-600 flex items-center gap-2">
          <Trophy /> Papan Skor
        </h2>
        <div className="flex gap-4">
            <button onClick={addTeam} className="text-sm bg-slate-100 px-3 py-1 rounded hover:bg-slate-200 text-slate-700">+ Tambah Tim</button>
            <button onClick={onBack} className="text-slate-500 hover:text-slate-800">Kembali</button>
        </div>
      </div>

      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 overflow-y-auto">
        {teams.map((team) => (
          <div key={team.id} className="bg-white border-2 border-slate-100 rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow flex flex-col items-center">
            <input 
              type="text" 
              value={team.name}
              onChange={(e) => updateName(team.id, e.target.value)}
              className="text-lg font-bold text-center text-slate-700 w-full mb-4 border-b border-transparent focus:border-yellow-400 focus:outline-none bg-transparent"
            />
            
            <div className="text-6xl font-black text-slate-800 mb-6 font-mono">
              {team.score}
            </div>

            <div className="flex gap-3 w-full justify-center">
              <button 
                onClick={() => updateScore(team.id, -5)}
                className="w-10 h-10 rounded-full bg-red-100 text-red-600 flex items-center justify-center hover:bg-red-200 font-bold"
              >
                -5
              </button>
              <button 
                onClick={() => updateScore(team.id, 5)}
                className="w-10 h-10 rounded-full bg-green-100 text-green-600 flex items-center justify-center hover:bg-green-200 font-bold"
              >
                +5
              </button>
              <button 
                onClick={() => updateScore(team.id, 10)}
                className="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center hover:bg-blue-200 font-bold"
              >
                +10
              </button>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

// 5. Timer Component
const ActivityTimer = ({ onBack }) => {
  const [timeLeft, setTimeLeft] = useState(600); // 10 minutes default
  const [isActive, setIsActive] = useState(false);
  const [initialTime, setInitialTime] = useState(600);

  useEffect(() => {
    let interval = null;
    if (isActive && timeLeft > 0) {
      interval = setInterval(() => {
        setTimeLeft(timeLeft => timeLeft - 1);
      }, 1000);
    } else if (timeLeft === 0) {
      setIsActive(false);
      // Play sound or alert here ideally
    }
    return () => clearInterval(interval);
  }, [isActive, timeLeft]);

  const toggleTimer = () => setIsActive(!isActive);
  
  const resetTimer = () => {
    setIsActive(false);
    setTimeLeft(initialTime);
  };

  const setDuration = (minutes) => {
    const seconds = minutes * 60;
    setInitialTime(seconds);
    setTimeLeft(seconds);
    setIsActive(false);
  };

  const formatTime = (seconds) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  };

  return (
    <div className="flex flex-col h-full items-center justify-center">
      <div className="w-full flex justify-between items-center mb-8 absolute top-6 px-6">
        <h2 className="text-2xl font-bold text-red-600 flex items-center gap-2">
          <Clock /> Timer Kegiatan
        </h2>
        <button onClick={onBack} className="text-slate-500 hover:text-slate-800">Kembali</button>
      </div>

      <div className="text-[8rem] md:text-[12rem] font-black font-mono text-slate-800 leading-none mb-8 tabular-nums">
        {formatTime(timeLeft)}
      </div>

      <div className="flex gap-6 mb-12">
        <button 
          onClick={toggleTimer}
          className={`px-8 py-4 rounded-full font-bold text-xl flex items-center gap-2 shadow-lg transition-transform active:scale-95 ${isActive ? 'bg-orange-100 text-orange-600' : 'bg-green-600 text-white hover:bg-green-700'}`}
        >
          {isActive ? <><Pause /> Pause</> : <><Play /> Mulai</>}
        </button>
        <button 
          onClick={resetTimer}
          className="px-8 py-4 rounded-full font-bold text-xl bg-slate-200 text-slate-700 hover:bg-slate-300 flex items-center gap-2 shadow-lg transition-transform active:scale-95"
        >
          <RotateCcw /> Reset
        </button>
      </div>

      <div className="grid grid-cols-4 gap-4">
        {[5, 10, 15, 20, 30, 45, 60].map(min => (
          <button
            key={min}
            onClick={() => setDuration(min)}
            className={`px-4 py-2 rounded-lg font-medium border-2 transition-colors ${initialTime === min * 60 ? 'border-red-500 bg-red-50 text-red-600' : 'border-slate-200 hover:border-slate-400'}`}
          >
            {min} Mnt
          </button>
        ))}
      </div>
    </div>
  );
};
